# EntityFramework.Extensions

Entity Framework 6 does not support automatic code-fist migrations for views, triggers and do not have other nice features like
check constraints, permissions as a part of model. This makes difficult to synchronize automatically the model in C# code and the
custommers database as a part of automatic software deployment.

EF6 allows to extend the data model using custom table and column annotations. Also you can add any SQL statemens after code-first migration will be generated by EF (for example to recreate views). The *EntityFramework.Extensions* package should extend EF by adding

* Triggers, Views, Constrains for enums, Description of columns and tables as a part of model
* Automatic code-first migration generation if the model has been changed
* Automatic sql statements generation

*Not ready*

## Examples

### Triggers

Registering triggers in the model
```C#
// raw
modelBuilder.Entity<User>().HasTrigger("TR_User_LogChange")
    .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
    .HasBody("INSERT INTO log.User SELECT Id, Name FROM INSERTED");

// encoded
modelBuilder.Entity<User>().HasTrigger("TR_User_LogChange")
    .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
    .HasBodyEncoded("SU5TRVJUIElOVE8gbG9nLlVzZXIgU0VMRUNUIElkLCBOYW1lIEZST00gSU5TRVJURUQ=");

// from resource
modelBuilder.Entity<User>().HasTrigger("TR_User_LogChange")
    .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
    .HasBody(assembly.GetManifestResourceStream("MyCompany.MyProduct.Data.Configuration.Sql.UserLogDelete.sql"));
```

Here is an example of generated code-first migration for newly created table.
```C#
public override void Up()
{
    CreateTable(
        "UserTable",
        c => new
        {
            Name = c.String(storeType: "VRCHAR(50)"),
            Id = c.Short(storeType: "INT"),
        },
        annotations: new Dictionary<string, object>
        {
            {
                "trigger", new[]
                {
                    new TriggerAnnotation("TR_User_LogChange")
                        .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
                        .HasBodyEncoded("SU5TRVJUIElOVE8gbG9nLlVzZXIgU0VMRUNUIElkLCBOYW1lIEZST00gSU5TRVJURUQ="),
                }
            },
        });
}
```

Generated sql statements
```SQL
CREATE TABLE [User] (
    [Id] [INT],
    [Name] [VARCHAR(50)]
)
CREATE TRIGGER [TR_User_LogChange] ON User AFTER UPDATE, INSERT AS
INSERT INTO log.User SELECT Id, Name FROM INSERTED
```
