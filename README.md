# EntityFramework.Extensions

Entity Framework 6 does not support automatic code-fist migrations for views, triggers and do not have check constraints, permissions as a part of the model. This makes difficult to synchronize the model in C# code and the customers systems for automatic software deployment.

Actually, EF6 allows to extend the data model using custom table and column annotations. Also you can write any SQL statemens after code-first migration will be generated by EF. The *EntityFramework.Extensions* package should allow you

* register triggers, view, constrains for enums as table / column annotations
* generate code-first migrations supporting mentioned features
* generate sql statements for generated code-first migrations (SQL Server Syntax)

All annotations are serializable, therefore they will be tracked by EF and by their change a new code-first migration will be automatically generated by EF.

*Not ready*

## Examples

### Triggers

Register triggers in the model
```C#
// raw
modelBuilder.Entity<User>().HasTrigger("TR_User_LogChange")
    .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
    .HasBody("INSERT INTO log.User SELECT Id, Name FROM INSERTED");

// from resource
modelBuilder.Entity<User>().HasTrigger("TR_User_LogChange")
    .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
    .HasBody(assembly.GetManifestResourceStream("MyCompany.MyProduct.Data.Configuration.Sql.UserLogDelete.sql"));
```

Generated code-first migration
```C#
public override void Up()
{
    AlterTableAnnotations(
        "User",
        c => new { },
        annotations: new Dictionary<string, AnnotationValues>
        {
            {
                "trigger",
                new AnnotationValues(oldValue: null, newValue: new[]
                    {
                    new TriggerAnnotation("TR_User_LogChange")
                        .After(TriggerEventEnum.Update, TriggerEventEnum.Insert)
                        .HasBodyEncoded("SU5TRVJUIElOVE8gbG9nLlVzZXIgU0VMRUNUIElkLCBOYW1lIEZST00gSU5TRVJURUQ="),
                    }
                )
            },
        });
}
```

Generated sql statements
```SQL
CREATE TRIGGER [TR_User_LogChange] ON User AFTER UPDATE, INSERT AS
INSERT INTO log.User SELECT Id, Name FROM INSERTED
```
